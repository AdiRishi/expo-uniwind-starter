# CLAUDE.md

This file provides guidance to AI agents when working with code in this repository.

## Commands

```bash
pnpm start                # Start Expo dev server
pnpm ios                  # Run on iOS simulator (requires prebuild)
pnpm android              # Run on Android emulator (requires prebuild)
pnpm web                  # Run on web

pnpm run check            # Run all checks (lint + prettier + typecheck)
pnpm run lint             # ESLint only (expo lint)
pnpm run typecheck        # TypeScript only (tsc --noEmit)
pnpm run format           # Auto-format with Prettier

pnpm run server:dev       # Start Nitro API server (localhost:3000)
pnpm run server:build     # Build server for deployment

pnpm run rename           # Rename project (updates package.json, app.json, bundle IDs)
pnpm expo prebuild        # Generate native projects (required before ios/android)
```

## Architecture

**Monorepo** (pnpm workspaces): root app + `server/` workspace (`@repo/server`).

### Client (Expo app in `src/`)

- **Expo SDK 55** with React Native 0.83, React 19, and React Compiler enabled
- **Routing**: Expo Router with file-based routes in `src/app/`. Route files are thin — they render screen components from `src/screens/`
- **Styling**: Tailwind CSS v4 via [Uniwind](https://uniwind.dev/). CSS entry point is `src/global.css` (theme tokens, dark mode variables). Metro is wrapped with `withUniwindConfig` in `metro.config.cjs`
- **Components**: [HeroUI Native](https://v3.heroui.com/docs/native/getting-started) for UI primitives. Custom components in `src/components/ui/` use `tailwind-variants` (`tv()`) for variant-based styling
- **Forms**: Tanstack Form via `createFormHook` (`src/hooks/form/use-app-form.ts`). Reusable field components in `src/components/form/` bind HeroUI Native primitives to form context. Zod schemas for client validation live in `src/schemas/`
- **Data fetching**: tRPC client (`@trpc/client` + `@trpc/tanstack-react-query`) connected to the server workspace. Client setup in `src/lib/trpc.ts`, provider wiring in `src/components/app-providers.tsx`
- **Tabs**: Native tabs via `expo-router/unstable-native-tabs` configured in `src/components/app-tabs.tsx`

### Server (`server/` workspace)

- **Nitro 3** (alpha) as the server framework, default deploy target: Cloudflare Workers
- **tRPC v11** for type-safe API. Router defined in `server/trpc/router.ts`, procedures in `server/trpc/routers/`. The `AppRouter` type is exported and consumed by the client
- **Catch-all handler** at `server/routes/api/trpc/[...]` bridges Nitro to tRPC via `fetchRequestHandler`
- Server uses `~` path alias (Nitro convention) for internal imports

### Path aliases

- `@/*` → `./src/*` (client code, configured in tsconfig.json)
- `@/assets/*` → `./assets/*`
- `~` → server root (Nitro convention, server code only)

## Conventions

- **Package manager**: pnpm (v10.x). Always use `pnpm` for install/scripts
- **TypeScript**: Strict mode. Server is excluded from root tsconfig
- **Import order**: Enforced by Prettier plugin — third-party first, then `@repo/*`, then `@/*`, then relative
- **Tailwind class sorting**: Enforced by `prettier-plugin-tailwindcss` with `tv()` function support
- **Variant styling**: Use `tailwind-variants` (`tv()`) for component variants, not conditional class strings
- **Theme customization**: Edit CSS custom properties in `src/global.css` (light/dark variants under `@layer theme`)
- **Platform-specific files**: Use `.ios.tsx`, `.android.tsx`, `.web.tsx` suffixes for platform overrides
- **Auto-generated**: `src/uniwind-types.d.ts` is generated by Uniwind — do not edit manually
- **Environment**: `EXPO_PUBLIC_API_URL` sets the API base URL (defaults to `http://localhost:3000`). Access via `src/lib/env.ts`
- **Component organization**:
  - `src/components/ui/` — Generic, reusable components (buttons, rows, typography, screen containers)
  - `src/components/screens/<screen-name>/` — Components specific to a single screen (e.g. `components/screens/home/kpi-card.tsx`)
  - `src/components/` — App-level components shared across screens but not purely UI primitives (providers, tabs, etc.)
  - Prefer extracting components into files rather than co-locating them inline in screen files. Screen files (`src/screens/`) should focus on data fetching, state, and composition

## Commit Convention

Use [Conventional Commits](https://www.conventionalcommits.org/) with **title only** (no description body):

```
<type>: <lowercase imperative summary>
```

**Types**: `feat`, `fix`, `refactor`, `chore`, `docs`, `style`, `init`

- `feat` — new functionality or capability
- `fix` — bug fix
- `refactor` — code restructuring without behavior change
- `chore` — dependencies, config, tooling, CI, skills
- `docs` — README, CLAUDE.md, AGENTS.md changes
- `style` — formatting only (no logic changes)
- `init` — project scaffolding (rare)

**Rules**: lowercase after the colon, imperative mood ("add X" not "added X"), no trailing period, no description body — title only.

## Pinned Versions

- `react-native-svg` pinned to 15.15.3 (not 15.15.1) to avoid a Node `buffer` import bug
- `hermes-compiler` overridden to `250829098.0.4` via `pnpm.overrides` — must match the Hermes V1 runtime built into React Native; do not bump independently. Native builds use `buildReactNativeFromSource` + `useHermesV1` via `expo-build-properties` in `app.json`
